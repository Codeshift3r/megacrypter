<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Megacrypter by tonikelope</title>
  </head>

  <body>
  <div id="fb-root"></div>
<script>(function(d, s, id) {
var js, fjs = d.getElementsByTagName(s)[0];
if (d.getElementById(id)) return;
js = d.createElement(s); js.id = id;
js.src = "//connect.facebook.net/es_ES/all.js#xfbml=1";
fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="lb-bg"></div>
    <header>
      <div class="inner">
        <img src="images/lock.png?raw=true" alt="Alt text" title="MC logo"><img src="images/logo.png?raw=true" alt="Alt text" title="MC logo">
        <h2>Crypted url forwarding for MEGA links.</h2>
        <a href="https://github.com/tonikelope/megacrypter" class="button"><small>View project on</small> GitHub</a>
        <div id="social_buttons"><div class="fb-like" data-href="//www.facebook.com/megacrypter" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
        <a href="//www.facebook.com/megacrypter" target="_blank"><img id="button_facebook" src="images/facebook.png" alt="facebook" /></a><a href="https://twitter.com/megacrypter" target="_blank"><img id="button_twitter" src="images/twitter.png" alt="twitter" /></a></div>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
<h1>
<a id="megacrypter" class="anchor" href="#megacrypter" aria-hidden="true"><span class="octicon octicon-link"></span></a>megacrypter</h1>

<img src="images/diagrama.png?raw=true">

<h2>What do you need to deploy your own Megacrypter?</h2>

<p>1) <strong>Apache</strong> (mod_rewrite ON) (Or another web server that supports URL rewrite)</p>

<p>2) <strong>PHP</strong> >= 5.5 (cURL + memcache + mbstring)</p>

<p>3) <strong>MySQL</strong> (optional for blacklist).</p>

<h3>5 steps installation instructions:</h3>

<p><strong>Step 1:</strong> download tarball (or clone repo) and upload to your server.</p>

<p><strong>Step 2:</strong> install composer dependencies -> <code>$ php composer.phar install</code></p>

<p><strong>Step 3:</strong> rename ALL /config .sample extension and edit miscellaneous.php and any other file you need.</p>

<p><strong>Step 4:</strong> prepare Apache virtual host:

<pre>
  &lt;VirtualHost *:80&gt;
    Servername megacrypter.mydomain
    DocumentRoot /var/www/megacrypter/public
    RewriteEngine On
    &lt;directory /var/www/megacrypter/public&gt;
      AllowOverride None
      Include /var/www/megacrypter/public/.htaccess
    &lt;/directory&gt; 
  &lt;/VirtualHost&gt;
</pre>

</p>

<p><strong>Step 5:</strong> ask  developers of your favourite download manager to recognize your new megacrypter links (or give it a try to <a 
href="https://github.com/tonikelope/megabasterd" target="_blank"><strong>MegaBasterd</strong></a> that supports any MC clon)</p>

<p>You're alone from here. Good luck!</p>

<h2>API DOC</h2>
<pre>
<div class="api_method"><strong>API URL -> </strong><em>http(s)://[BASE_URL]/api</em>
(<strong>Content-Type:</strong> <em>application/json</em>)</div>
</pre>

<h3>Protecting MEGA links</h3>
<h4>Request:</h4>
<pre>
{"m": "crypt", 
"links": [<em>"MEGA_LINK_1"</em>, <em>"MEGA_LINK_2"</em> ... <em>"MEGA_LINK_N"</em>],
*"expire": <em>0-6</em>,
*"no_expire_token": <em>true OR false</em>,
*"tiny_url": <em>true OR false</em>,
*"app_finfo": <em>true OR false</em>,
*"hide_name": <em>true OR false</em>,
*"pass": <em>"PASS"</em>,
*"referer": <em>"DOMAIN_NAME"</em>,
*"extra_info": <em>"EXTRA_INFO"</em>,
*"email": <em>"EMAIL"</em>}
</pre>

<h5>*Optional params:</h5>
<em>1) Expiration values: 0 -> never (default), 1 -> 10 minutes, 2 -> 1 hour...</em>
<em>2) True by default.</em>
<em>3) Tiny url option is false by default.</em>
<em>4) Append file info option is false by default.</em>
<em>5) Hide name option is false by default.</em>
<em>6) Passwords are case-sensitive.</em>
<em>7) Referer is not required to include 'http://'. It's limited to 256 chars</em>
<em>8) Extra-info is limited to 256 chars.</em>
<em>9) Email is limited to 256 chars.</em>
<em>Note: link list is limited to 500</em>

<h4>Response:</h4>
<pre>
{"links": [<em>"MC_LINK_1"</em>, <em>"MC_LINK_2"</em> ... <em>"MC_LINK_N"</em>]}
</pre>

<h3>Retrieving link information</h3>
<h4>Request:</h4>
<pre>
{"m": <em>"info"</em>, 
"link": <em>"MC_LINK"</em>,
*"reverse": <em>"port:b64_proxy_auth[:host]</em>"}
</pre>
        
<h5>*Optional params:</h5>
<em>1) Reverse query: Megacrypter will connect to MEGA API using HTTPS proxy running on the client. Client must send port and 'user:password' (base64 encoded) for proxy auth (host is optional).</em> 
        
<h4>Response:</h4>
<pre>
{"name": <em>"FILE_NAME" OR "CRYPTED_FILE_NAME"</em>, 
"path": <em>false OR "PATH" OR "CRYPTED_FILE_PATH"</em>,
"size": <em>FILE_SIZE</em>, 
"key": <em>"FILE_KEY" OR "CRYPTED_FILE_KEY"</em>,
"extra": <em>false OR "EXTRA_INFO" OR "CRYPTED_EXTRA_INFO"</em>,
"expire": <em>false OR "EXPIRE_TIMESTAMP#NOEXPIRE_TOKEN"</em>,
"pass": <em>false OR "ITER_LOG2#KCV#SALT#IV"</em>}
</pre>

<h5>About password protected files:</h5>

File name, file key, and extra-info will be returned crypted using AES CBC (PKCS7) with 256 bits key derivated from pass (PBKDF2 SHA256).

Follow this <strong>algorithm</strong> to decrypt crypted fields:

<pre>
<em>REPEAT
        
    password := read_password()
    
    info_key := hmac := hmac_sha256(password, base64_dec(SALT) + hex2bin('00000001'))
    
    FOR i=2 : 1 : pow(2, ITER_LOG2)
        
        hmac := hmac_sha256(password, hmac)
    
        info_key := info_key XOR hmac
    
    END

UNTIL aes_cbc_dec(base64_dec(KCV), info_key, base64_dec(IV)) = info_key

crypted_field := aes_cbc_dec(base64_dec(CRYPTED_FIELD), info_key, base64_dec(IV))
</pre>

<h3>Getting a temporary download url to the (crypted) file</h3>
<h4>Request:</h4>
<pre>
{"m": "dl", 
"link": <em>"MC_LINK"</em>,
*"ssl": <em>true OR false</em>,
*"noexpire": <em>"NOEXPIRE_TOKEN"</em>,
*"sid": <em>"MEGA_SID"</em>,
*"reverse": <em>"port:b64_proxy_auth[:host]</em>"}
</pre>

<h5>*Optional params:</h5>
<em>1) Default is false (better performance in slow machines)</em>
<em>2) If link has expiration time you can use NOEXPIRE_TOKEN (cached from a previous "info-request") to bypass it and get the download url.</em>
<em>3) MEGA SESSION ID (for download MegaCrypter link using your MEGA PRO ACCOUNT)</em>
<em>4) Reverse query: Megacrypter will connect to MEGA API using HTTPS proxy running on the client. Client must send port and 'user:password' (base64 encoded) for proxy auth (host is optional).</em>

<h4>Response:</h4>
<pre>
{"url": <em>"MEGA_TEMP_URL" OR "CRYPTED_MEGA_TEMP_URL"</em>,
"pass": <em>false OR "IV"</em>}
</pre>

<em>Note: use the same algorithm described above to decrypt temp url (if password protected)</em>


<h3>Error responses (because shit happens...)</h3>
<pre>
{"error": <em>ERROR_CODE</em>}
</pre>

<h4>Error codes:</h4>
<pre>
MC_EMETHOD(1)
MC_EREQ(2)
MC_ETOOMUCHLINKS(3)
MC_ENOLINKS(4)
MC_INTERNAL_ERROR(21)
MC_LINK_ERROR(22)
MC_BLACKLISTED_LINK(23)
MC_EXPIRED_LINK(24)
MEGA_EINTERNAL(-1)
MEGA_EARGS(-2)
MEGA_EAGAIN(-3)
MEGA_ERATELIMIT(-4)
MEGA_EFAILED(-5)
MEGA_ETOOMANY(-6)
MEGA_ERANGE(-7)
MEGA_EEXPIRED(-8)
MEGA_ENOENT(-9)
MEGA_ECIRCULAR(-10)
MEGA_EACCESS(-11)
MEGA_EEXIST(-12)
MEGA_EINCOMPLETE(-13)
MEGA_EKEY(-14)
MEGA_ESID(-15)
MEGA_EBLOCKED(-16)
MEGA_EOVERQUOTA(-17)
MEGA_ETEMPUNAVAIL(-18)
MEGA_ETOOMANYCONNECTIONS(-19)
MEGA_EWRITE(-20)
MEGA_EREAD(-21)
MEGA_EAPPKEY(-22)
MEGA_EDLURL(-101)
</pre>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/tonikelope/megacrypter/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/tonikelope/megacrypter/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/tonikelope/megacrypter"></a> is maintained by <a href="https://github.com/tonikelope">tonikelope</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
